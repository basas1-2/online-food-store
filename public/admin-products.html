<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin Products - Food store</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<nav class="site-nav">
  <div class="nav-brand">Food store - Admin</div>
  <div>
    <a href="admin.html">Dashboard</a>
    <a href="index.html">Home</a>
    <a id="logoutBtn" href="#">Logout</a>
  </div>
</nav>

<div class="container">
  <h2>All Products</h2>
  <div id="adminProducts" class="post-grid"></div>
</div>

<script>
const token = localStorage.getItem('token');
const role = localStorage.getItem('role');
if (!token || role !== 'admin') { alert('Access denied'); window.location='login.html'; }

async function loadAdminProducts(){
  try{
    const res = await fetch('/posts');
    const posts = await res.json();
    document.getElementById('adminProducts').innerHTML = posts.map(p=>`
      <div class="post">
        ${p.image?`<img class="thumb" src="${p.image}" alt="${p.title}">`:''}
        <h3>${escapeHtml(p.title)}</h3>
        <div>Price: $${p.price||0}</div>
        <p>${escapeHtml(p.content).slice(0,120)}</p>
        <div class="actions">
          <button onclick="edit(${JSON.stringify(p._id)})" class="btn-edit">Edit</button>
          <button onclick="del('${p._id}')" class="btn-delete">Delete</button>
        </div>
      </div>
    `).join('');
  }catch(err){ console.error(err); }
}

function escapeHtml(unsafe){ return unsafe? unsafe.replace(/[&<>\"]/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c])):'' }

function edit(id){ const title = prompt('New title'); const content = prompt('New content'); const price = prompt('New price'); if(!title||!content) return; fetch('/posts/'+id,{ method:'PUT', headers:{'Content-Type':'application/json','Authorization':token}, body: JSON.stringify({ title, content, price: parseFloat(price)||0 })}).then(()=>loadAdminProducts()); }
function del(id){ if(!confirm('Delete?')) return; fetch('/posts/'+id,{ method:'DELETE', headers:{'Authorization':token} }).then(()=>loadAdminProducts()); }

loadAdminProducts();
</script>
</body>
</html>